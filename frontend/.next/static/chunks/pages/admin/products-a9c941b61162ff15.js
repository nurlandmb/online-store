(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[209],{2678:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/products",function(){return r(434)}])},8652:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var n=r(5893);function o(t){return(0,n.jsx)("div",{className:t.fixed?"loader-wrapper fixed ".concat(t.addClass):"loader-wrapper ".concat(t.addClass),children:(0,n.jsxs)("div",{className:"loader",children:[(0,n.jsx)("div",{}),(0,n.jsx)("div",{})]})})}r(7294)},434:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return v}});var n=r(7568),o=r(1799),s=r(9396),c=r(828),i=r(655),a=r(5893),u=r(7294),d=r(6064),l=r(8383),p=r(9669),m=r.n(p),f=r(2920),_=(0,d.$j)(function(t){return{profile:t.profile,adminProduct:t.adminProduct}},function(t){return{productEdit:function(e,r){return t((0,l.NQ)(e,r))},productEditClose:function(){return t((0,l.IC)())}}})(function(t){var e,r=(0,c.Z)((0,u.useState)(t.product.isVisible),2),o=r[0],s=r[1],d=(e=(0,n.Z)(function(e){var r;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,m().post("/api/product/edit/".concat(t.product._id),{isVisible:!o,isPopular:t.product.isPopular},{headers:{authorization:"Bearer ".concat(t.profile.userInfo.token)}})];case 1:return e.sent(),s(!o),[3,3];case 2:return r=e.sent(),f.Am.error(r),[3,3];case 3:return[2]}})}),function(t){return e.apply(this,arguments)});return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"product "+t.addClass,children:[(0,a.jsx)("div",{className:"product__img",children:(0,a.jsx)("img",{src:t.product.image,alt:t.product.name})}),(0,a.jsxs)("div",{className:"product__content",children:[(0,a.jsxs)("div",{className:"product__content-top",children:[(0,a.jsx)("h3",{className:"product__content-top__title",children:t.product.name}),(0,a.jsx)("p",{className:"product__content-top__info",children:t.product.category})]}),(0,a.jsx)("p",{className:"product__content-descr",children:t.product.description}),(0,a.jsxs)("div",{className:"product__content-bottom",children:[(0,a.jsxs)("p",{className:"product__content-bottom__price",children:[t.product.priceWithDiscount?(0,a.jsxs)(a.Fragment,{children:[t.product.priceWithDiscount,"₸"," ",(0,a.jsxs)("span",{children:[t.product.price,"₸"]})]}):t.product.price+"₸"," "]}),(0,a.jsxs)("div",{className:"product__content-bottom__edit",children:[(0,a.jsx)("button",{className:"product__content-bottom__edit-item hide",onClick:d,children:o?(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),(0,a.jsx)("button",{className:"product__content-bottom__edit-item edit",onClick:function(){return t.productEdit(t.product,"edit")},children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]})]})]})]})})}),h=r(7329),x=r(8652),j=r(1889),g=r(1163),v=(0,d.$j)(function(t){return{profile:t.profile,products:t.products,adminProduct:t.adminProduct}},function(t){return{loadProducts:function(){return t((0,j.QD)())},createProduct:function(e,r){return t((0,l.ry)(e,r))},productEdit:function(e){return t((0,l.NQ)(e))},productEditClose:function(){return t((0,l.IC)())},editExistingProduct:function(e,r){return t((0,l.D3)(e,r))},productDeleteHandler:function(e,r){return t((0,l.CA)(e,r))}}})(function(t){var e,r,d=function(t){var e=t.target.closest(".admin-products__form-wrapper");e.classList.remove("invalid"),e.querySelector(".admin-products__form-placeholder").classList="admin-products__form-placeholder active"},l=(0,g.useRouter)(),p=(0,c.Z)((0,u.useState)({image:"",name:"",description:"",price:"",discount:!1,isPopular:!1,priceWithDiscount:"",category:"",shortInfo:""}),2),j=p[0],v=p[1],N=(0,c.Z)((0,u.useState)(!1),2),y=N[0],b=N[1];(0,u.useEffect)(function(){t.adminProduct.isLoading||t.adminProduct.error||t.loadProducts()},[t.adminProduct.isLoading]),(0,u.useEffect)(function(){v((0,s.Z)((0,o.Z)({},t.adminProduct.product),{discount:"object"!=typeof t.adminProduct.product.priceWithDiscount}))},[t.adminProduct.product]),(0,u.useEffect)(function(){t.profile.isLoggedIn||l.push("/admin/signin")},[]);var w=function(t){var e=t.target.closest(".admin-products__form-wrapper").querySelector(".admin-products__form-placeholder");e.classList="admin-products__form-placeholder active",""===t.target.value.trim()&&e.classList.remove("active")},C=(e=(0,n.Z)(function(e){var r,n,c,a;return(0,i.__generator)(this,function(i){switch(i.label){case 0:e.target.closest(".admin-products__form-upload").classList.remove("invalid"),r=e.target.files[0],(n=new FormData).append("file",r),i.label=1;case 1:return i.trys.push([1,3,,4]),b(!0),[4,m().post("/api/upload",n,{headers:{"Content-Type":"multipart/form-data",authorization:"Bearer ".concat(t.profile.userInfo.token)}})];case 2:return c=i.sent().data,f.Am.success("Image uploaded successfully"),b(!1),v((0,s.Z)((0,o.Z)({},j),{image:c.secure_url})),[3,4];case 3:return console.log(a=i.sent()),f.Am.error(a),b(!1),[3,4];case 4:return[2]}})}),function(t){return e.apply(this,arguments)}),k=function(){var t={image:j.image,name:j.name,description:j.description,price:j.price,category:j.category};j.discount&&(t.priceWithDiscount="object"==typeof j.priceWithDiscount?"":j.priceWithDiscount);var e=Object.keys(t),r=Object.values(t).map(function(t,r){return String(t).trim()?"":e[r]}).filter(function(t){return!!t}),n=document.querySelector(".admin-products__popup");return r.forEach(function(t){n.querySelector("#"+t).classList.add("invalid")}),!!r.length},Z=(r=(0,n.Z)(function(e){return(0,i.__generator)(this,function(r){return e.preventDefault(),k()||("create"===j.type?t.createProduct(j,t.profile.userInfo):t.editExistingProduct(j,t.profile.userInfo)),[2]})}),function(t){return r.apply(this,arguments)}),P=function(e){if("Удалить товар"===e.target.textContent){e.target.textContent="Вы уверены?",e.target.classList.add("active"),setTimeout(function(){e.target.textContent="Удалить товар"},3e3);return}t.productDeleteHandler(j,t.profile.userInfo),e.target.textContent="Удалить товар",e.target.classList.remove("active")};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h.Z,{addClass:"admin-products__popup",active:t.adminProduct.popupActive,closePopup:function(){return t.productEditClose()},children:[t.adminProduct.isLoading&&(0,a.jsx)(x.Z,{fixed:!0}),(0,a.jsxs)("form",{className:"admin-products__form",onSubmit:Z,children:[(0,a.jsxs)("div",{className:"admin-products__form-upload",id:"image",children:[y&&(0,a.jsx)(x.Z,{fixed:!0}),j.image?(0,a.jsxs)("div",{className:"admin-products__form-upload__wrapper",children:[(0,a.jsx)("img",{className:"admin-products__form-upload__img",src:j.image,alt:j.name}),(0,a.jsx)("button",{className:"admin-products__form-upload__button",onClick:function(t){return v((0,s.Z)((0,o.Z)({},j),{image:""}))},children:"Удалить"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{className:"admin-products__form-upload__input",type:"file",id:"file-upload",accept:".jpg, .jpeg, .png",onChange:C}),(0,a.jsxs)("label",{className:"admin-products__form-upload__label",htmlFor:"file-upload",children:[(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),(0,a.jsx)("span",{children:"Загрузите изображение (Не больше 1мб)"})]})]})]}),(0,a.jsxs)("div",{className:"admin-products__form-wrapper",id:"name",children:[(0,a.jsx)("label",{className:j.name?"active admin-products__form-placeholder":"admin-products__form-placeholder",children:"Название"}),(0,a.jsx)("input",{onBlur:w,onFocus:d,className:"admin-products__form-input",type:"text",value:j.name,onChange:function(t){return v((0,s.Z)((0,o.Z)({},j),{name:t.target.value}))}})]}),(0,a.jsxs)("div",{className:"admin-products__form-wrapper",id:"name",children:[(0,a.jsx)("label",{className:j.shortInfo?"active admin-products__form-placeholder":"admin-products__form-placeholder",children:"Короткая информация"}),(0,a.jsx)("input",{onBlur:w,onFocus:d,className:"admin-products__form-input",type:"text",value:j.shortInfo,onChange:function(t){return v((0,s.Z)((0,o.Z)({},j),{shortInfo:t.target.value}))}})]}),(0,a.jsxs)("div",{className:"admin-products__form-wrapper",id:"description",children:[(0,a.jsx)("textarea",{onBlur:w,onFocus:d,className:"admin-products__form-input textarea",type:"text",value:j.description,onChange:function(t){return v((0,s.Z)((0,o.Z)({},j),{description:t.target.value}))}}),(0,a.jsx)("label",{className:j.description?"active admin-products__form-placeholder":"admin-products__form-placeholder",children:"Описание"})]}),(0,a.jsxs)("div",{className:"admin-products__form-wrapper",id:"price",children:[(0,a.jsx)("label",{className:j.price?"active admin-products__form-placeholder":"admin-products__form-placeholder",children:"Цена"}),(0,a.jsx)("input",{onBlur:w,onFocus:d,className:"admin-products__form-input",type:"number",value:j.price,onChange:function(t){return v((0,s.Z)((0,o.Z)({},j),{price:t.target.value}))}})]}),(0,a.jsxs)("div",{className:"admin-products__form-wrapper flex",children:[(0,a.jsx)("label",{className:"admin-products__form-text",htmlFor:"discount",children:"Скидка"}),(0,a.jsxs)("label",{className:"check",children:[(0,a.jsx)("input",{id:"discount",type:"checkbox",checked:j.discount,onChange:function(t){return v((0,s.Z)((0,o.Z)({},j),{discount:!j.discount}))}}),(0,a.jsx)("span",{})]})]}),j.discount&&(0,a.jsxs)("div",{className:"admin-products__form-wrapper",id:"priceWithDiscount",children:[(0,a.jsx)("label",{className:j.priceWithDiscount?"active admin-products__form-placeholder":"admin-products__form-placeholder",children:"Цена со скидкой"}),(0,a.jsx)("input",{onBlur:w,onFocus:d,className:"admin-products__form-input",type:"number",value:"object"==typeof j.priceWithDiscount?"":j.priceWithDiscount,onChange:function(t){return v((0,s.Z)((0,o.Z)({},j),{priceWithDiscount:t.target.value}))}})]}),(0,a.jsxs)("div",{className:"admin-products__form-wrapper",id:"category",children:[(0,a.jsx)("label",{className:j.category?"active admin-products__form-placeholder":"admin-products__form-placeholder",children:"Категория"}),(0,a.jsx)("input",{onBlur:w,onFocus:d,className:"admin-products__form-input",type:"text",value:j.category,onChange:function(t){return v((0,s.Z)((0,o.Z)({},j),{category:t.target.value}))}})]}),(0,a.jsxs)("div",{className:"admin-products__form-wrapper flex",children:[(0,a.jsx)("label",{className:"admin-products__form-text",htmlFor:"ispopular",children:"Популярный"}),(0,a.jsxs)("label",{className:"check",children:[(0,a.jsx)("input",{id:"ispopular",type:"checkbox",checked:j.isPopular,onChange:function(t){return v((0,s.Z)((0,o.Z)({},j),{isPopular:!j.isPopular}))}}),(0,a.jsx)("span",{})]})]}),(0,a.jsx)("button",{className:"admin-products__form-submit",disabled:t.adminProduct.isLoading,children:"Сохранить"}),"edit"===t.adminProduct.product.type&&(0,a.jsx)("button",{className:"admin-products__form-delete",type:"button",onClick:function(t){return P(t)},children:"Удалить товар"})]})]}),(0,a.jsx)("section",{className:"section admin-products",children:(0,a.jsxs)("div",{className:"container",children:[(0,a.jsxs)("div",{className:"admin-products__top",children:[(0,a.jsx)("h2",{className:"section-title admin-products__list",children:"Все продукты"}),(0,a.jsx)("button",{className:"admin-products__top-button",onClick:function(){return t.productEdit({category:"",description:"",image:"",isPopular:!1,discount:!1,isVisible:!0,name:"",price:"",priceWithDiscount:"",type:"create"})},children:"Добавить товар"})]}),(0,a.jsx)("ul",{className:"admin-products__list",children:t.products.products.map(function(t){return(0,a.jsx)(_,{addClass:"admin-products__list-item",product:t,admin:!0},t._id)})})]})})]})})},1889:function(t,e,r){"use strict";r.d(e,{Pc:function(){return m},Uy:function(){return l},QD:function(){return d},xq:function(){return h}});var n=r(7568),o=r(655),s=r(9669),c=r.n(s),i=r(2031),a=r(2920),u=function(t){return t.response&&(t.response.data.message||t.message)};c().defaults.baseURL="http://localhost:5000";var d=function(){var t;return t=(0,n.Z)(function(t){var e;return(0,o.__generator)(this,function(r){switch(r.label){case 0:t(_()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,c().get("/api/product")];case 2:return t(h(r.sent().data)),[3,4];case 3:return e=r.sent(),a.Am.error(u(e)),t(x(e)),console.log(e),[3,4];case 4:return[2]}})}),function(e){return t.apply(this,arguments)}},l=function(){var t;return t=(0,n.Z)(function(t){var e;return(0,o.__generator)(this,function(r){switch(r.label){case 0:t(p()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,c().get("/api/product/categories")];case 2:return t(m(r.sent().data)),[3,4];case 3:return e=r.sent(),a.Am.error(u(e)),t(f(e)),[3,4];case 4:return[2]}})}),function(e){return t.apply(this,arguments)}},p=function(){return{type:i.h0}},m=function(t){return{type:i.Be,payload:t}},f=function(t){return{type:i._7,payload:t}},_=function(){return{type:i.vb}},h=function(t){return{type:i.x3,payload:t}},x=function(t){return{type:i.SM,payload:t}}}},function(t){t.O(0,[774,888,179],function(){return t(t.s=2678)}),_N_E=t.O()}]);